<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹ä¹ä¹˜æ³•ç·´ç¿’éŠæˆ²</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Icon = ({ type, className = "w-6 h-6" }) => {
            const icons = {
                star: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
                clock: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>,
                trophy: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M6 2h12v5a6 6 0 01-12 0V2zm-3 7h2a4 4 0 008 0h2a4 4 0 008 0h2v2a8 8 0 01-8 8h-4a8 8 0 01-8-8V9zm9 11v3m-4 0h8"/></svg>,
                play: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>,
                user: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
                chart: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 3v18h18M9 17V9m6 8V5"/></svg>,
                down: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M23 18l-9.5-9.5-5 5L1 6M17 18h6v-6"/></svg>,
                calendar: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            };
            return icons[type] || null;
        };

        function App() {
            const [state, setState] = useState('welcome');
            const [name, setName] = useState('');
            const [tempName, setTempName] = useState('');
            const [timeLimit, setTimeLimit] = useState(60);
            const [timeLeft, setTimeLeft] = useState(60);
            const [score, setScore] = useState(0);
            const [question, setQuestion] = useState({ num1: 0, num2: 0 });
            const [answer, setAnswer] = useState('');
            const [feedback, setFeedback] = useState('');
            const [total, setTotal] = useState(0);
            const [scores, setScores] = useState({});
            const [highScores, setHighScores] = useState({});
            const [type, setType] = useState('all');

            const typeNames = {
                all: 'å…¨éƒ¨é¡Œç›®', '2': '2çš„å€æ•¸', '3': '3çš„å€æ•¸', '4': '4çš„å€æ•¸',
                '5': '5çš„å€æ•¸', '6': '6çš„å€æ•¸', '7': '7çš„å€æ•¸', '8': '8çš„å€æ•¸',
                '9': '9çš„å€æ•¸', even: 'å¶æ•¸çš„å€æ•¸', '235': '2,3,5çš„å€æ•¸'
            };

            // è¨ˆç®—çå‹µå¾½ç« 
            const getBadges = () => {
                const badges = {};
                const checkType = (typeValue, label) => {
                    const qs = [];
                    for (let i = 1; i <= 9; i++) {
                        for (let j = 1; j <= 9; j++) {
                            if (typeValue === 'all' || 
                                (typeValue === 'even' && ([2,4,6,8].includes(i) || [2,4,6,8].includes(j))) ||
                                (typeValue === '235' && ([2,3,5].includes(i) || [2,3,5].includes(j))) ||
                                (i === parseInt(typeValue) || j === parseInt(typeValue))) {
                                qs.push(`${i}x${j}`);
                            }
                        }
                    }
                    const allScores = qs.map(q => scores[q] || 50);
                    const minScore = Math.min(...allScores);
                    if (minScore >= 100) return { level: 3, badge: 'ğŸ’¯', name: 'æ»¿åˆ†ç' };
                    if (minScore >= 90) return { level: 2, badge: 'ğŸ…', name: 'ç²¾é€šç' };
                    if (minScore >= 80) return { level: 1, badge: 'â­', name: 'å„ªç§€ç' };
                    return null;
                };
                
                ['all', '2', '3', '4', '5', '6', '7', '8', '9', 'even', '235'].forEach(t => {
                    const result = checkType(t, typeNames[t]);
                    if (result) badges[t] = result;
                });
                return badges;
            };

            const [badges, setBadges] = useState({});
            const [showHelp, setShowHelp] = useState(false);

            useEffect(() => {
                if (name) {
                    const saved = localStorage.getItem(`scores_${name}`);
                    const savedHS = localStorage.getItem(`highscores_${name}`);
                    if (saved) setScores(JSON.parse(saved));
                    else {
                        const init = {};
                        for (let i = 1; i <= 9; i++) for (let j = 1; j <= 9; j++) init[`${i}x${j}`] = 50;
                        setScores(init);
                    }
                    if (savedHS) setHighScores(JSON.parse(savedHS));
                    setBadges(getBadges());
                }
            }, [name]);

            useEffect(() => {
                if (name && Object.keys(scores).length > 0) {
                    localStorage.setItem(`scores_${name}`, JSON.stringify(scores));
                    setBadges(getBadges());
                }
            }, [scores]);

            useEffect(() => {
                if (name && Object.keys(highScores).length > 0) localStorage.setItem(`highscores_${name}`, JSON.stringify(highScores));
            }, [highScores]);

            const getQuestions = () => {
                const all = [];
                for (let i = 1; i <= 9; i++) for (let j = 1; j <= 9; j++) all.push({ num1: i, num2: j });
                if (type === 'all') return all;
                if (type === 'even') return all.filter(q => [2,4,6,8].includes(q.num1) || [2,4,6,8].includes(q.num2));
                if (type === '235') return all.filter(q => [2,3,5].includes(q.num1) || [2,3,5].includes(q.num2));
                const n = parseInt(type);
                return all.filter(q => q.num1 === n || q.num2 === n);
            };

            const genQuestion = () => {
                const qs = getQuestions();
                const weights = qs.map(q => Math.max(1, 101 - (scores[`${q.num1}x${q.num2}`] || 50)));
                const total = weights.reduce((a, b) => a + b, 0);
                let r = Math.random() * total;
                for (let i = 0; i < weights.length; i++) {
                    r -= weights[i];
                    if (r <= 0) { setQuestion(qs[i]); setAnswer(''); setFeedback(''); return; }
                }
            };

            const start = () => { setState('playing'); setScore(0); setTotal(0); setTimeLeft(timeLimit); genQuestion(); };

            useEffect(() => {
                if (state === 'playing' && timeLeft > 0) {
                    const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(t);
                } else if (timeLeft === 0 && state === 'playing') {
                    const curr = highScores[type];
                    if (!curr || score > curr.score) {
                        const newHS = { ...highScores };
                        newHS[type] = { score, date: new Date().toLocaleString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }) };
                        setHighScores(newHS);
                    }
                    setState('finished');
                }
            }, [timeLeft, state]);

            const check = () => {
                const correct = question.num1 * question.num2;
                const userNum = parseInt(answer);
                const key = `${question.num1}x${question.num2}`;
                const newScores = { ...scores };
                const oldScore = newScores[key] || 50;
                
                if (userNum === correct) {
                    setScore(score + 1); setFeedback('æ­£ç¢ºï¼å¤ªæ£’äº†ï¼ğŸ‰');
                    newScores[key] = Math.min(100, oldScore + 10);
                    setTimeout(() => { setTotal(total + 1); genQuestion(); }, 800);
                } else {
                    setFeedback(`ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${correct}`);
                    newScores[key] = Math.max(0, oldScore - 1);
                    setTimeout(() => { setTotal(total + 1); genQuestion(); }, 1500);
                }
                setScores(newScores);
                
                // æª¢æŸ¥æ˜¯å¦ç²å¾—æ–°å¾½ç« 
                setTimeout(() => {
                    const newBadges = getBadges();
                    const oldBadgeKeys = Object.keys(badges);
                    const newBadgeKeys = Object.keys(newBadges);
                    
                    newBadgeKeys.forEach(key => {
                        if (!oldBadgeKeys.includes(key) || (badges[key] && newBadges[key].level > badges[key].level)) {
                            // æ–°ç²å¾—å¾½ç« æˆ–å‡ç´šå¾½ç« 
                            console.log(`ç²å¾—æ–°å¾½ç« ï¼š${typeNames[key]} - ${newBadges[key].name}`);
                        }
                    });
                }, 2000);
            };

            if (state === 'welcome') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-400 via-purple-400 to-pink-400 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="text-yellow-500 mx-auto mb-4 animate-pulse"><Icon type="star" className="w-20 h-20 mx-auto" /></div>
                                <h1 className="text-4xl font-bold text-purple-600 mb-2">ç†Šæ¨‚æ¨‚ä¹ä¹ä¹˜æ³•</h1>
                                <h2 className="text-2xl font-bold text-pink-600 mb-2">ç·´ç¿’éŠæˆ²</h2>
                                <p className="text-gray-600 text-sm">å€‹äººåŒ–å­¸ç¿’ç³»çµ±</p>
                            </div>
                            <div className="mb-6">
                                <label className="block text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2"><Icon type="user" className="w-5 h-5" /> è«‹è¼¸å…¥ä½ çš„åå­—</label>
                                <input type="text" value={tempName} onChange={e => setTempName(e.target.value)} onKeyPress={e => e.key === 'Enter' && tempName.trim() && (setName(tempName.trim()), setState('setup'))} placeholder="è¼¸å…¥åå­—..." className="w-full text-xl px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-500" autoFocus />
                            </div>
                            <button onClick={() => tempName.trim() && (setName(tempName.trim()), setState('setup'))} disabled={!tempName.trim()} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform disabled:opacity-50 shadow-lg mb-3">é–‹å§‹ä½¿ç”¨</button>
                            <button onClick={() => setShowHelp(true)} className="w-full bg-gray-100 text-gray-700 text-base font-semibold py-3 rounded-xl hover:bg-gray-200 transition-colors">ğŸ“– ä½¿ç”¨èªªæ˜</button>
                        </div>

                        {/* ä½¿ç”¨èªªæ˜å½ˆçª— */}
                        {showHelp && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={() => setShowHelp(false)}>
                                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                    <h2 className="text-3xl font-bold text-purple-600 mb-4 text-center">ğŸ“– ä½¿ç”¨èªªæ˜</h2>
                                    
                                    <div className="mb-6">
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">è»Ÿé«”åç¨±</h3>
                                        <p className="text-gray-700">ç†Šæ¨‚æ¨‚ä¹ä¹ä¹˜æ³•ç·´ç¿’ / æ•¸å­¸éŠæˆ²å°ç¨‹å¼ / ç†Šæ¨‚æ¨‚åŸå‰µ</p>
                                    </div>

                                    <div className="mb-6">
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">ä½¿ç”¨æ–¹å¼</h3>
                                        <ol className="list-decimal list-inside space-y-2 text-gray-700">
                                            <li>ç™»å…¥æ™‚è«‹å–ä¸€å€‹å¸³è™Ÿåç¨±</li>
                                            <li>ä½¿ç”¨ç´€éŒ„å’Œå­¸ç¿’ç‹€æ³åˆ†ææœƒè¨˜éŒ„åœ¨å¸³è™Ÿä¸Š</li>
                                        </ol>
                                    </div>

                                    <div className="mb-6">
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">èªªæ˜</h3>
                                        <div className="space-y-4 text-gray-700">
                                            <div>
                                                <span className="font-semibold">1. åˆ†å€ç·´ç¿’è¨­è¨ˆï¼š</span>
                                                <p className="ml-4 mt-1">ä¾ç…§ä¹ä¹ä¹˜æ³•å­¸ç¿’æ–¹å¼ï¼Œå€åˆ†ä¸åŒæ•¸å­—æˆ–ä¸åŒé¡å‹çš„ç·´ç¿’å€å¡Šï¼Œæ¯å€‹å€å¡Šåˆ†é–‹ç´€éŒ„æœ€é«˜æˆç¸¾ï¼Œé…åˆå­¸ç«¥çš„å­¸ç¿’æ­¥é©Ÿã€‚</p>
                                            </div>
                                            <div>
                                                <span className="font-semibold">2. è¨ˆåˆ†èˆ‡çå‹µæ©Ÿåˆ¶ï¼š</span>
                                                <p className="ml-4 mt-1">ä¹ä¹ä¹˜æ³•ç¸½å…±æœ‰81é¡Œé¡Œç›®ï¼Œæ¯å€‹é¡Œç›®ä»¥50åˆ†ç‚ºèµ·é»ï¼Œç­”å°ä¸€æ¬¡åŠ 10åˆ†ï¼Œç­”éŒ¯ä¸€æ¬¡æ‰£1åˆ†ã€‚æ¯å€‹é¡Œç›®é”åˆ°80åˆ†ã€90åˆ†ã€100åˆ†æ™‚ï¼Œä¾åºæœ‰ä¸åŒçš„çå‹µå¾½ç« å›é¥‹ï¼ˆâ­å„ªç§€çã€ğŸ…ç²¾é€šçã€ğŸ’¯æ»¿åˆ†çï¼‰ã€‚</p>
                                            </div>
                                            <div>
                                                <span className="font-semibold">3. æ™ºèƒ½å‡ºé¡Œç³»çµ±ï¼š</span>
                                                <p className="ml-4 mt-1">ç­”éŒ¯çš„é¡Œç›®ç”±ç³»çµ±è¨˜éŒ„ï¼Œå‡ºé¡Œæ™‚å¢åŠ éŒ¯èª¤é¡Œç›®çš„å‡ºé¡Œæ©Ÿç‡ï¼Œè®“ä¹ä¹ä¹˜æ³•ç·´ç¿’ç¨‹å¼èƒ½é…åˆå€‹äººå­¸ç¿’æ›²ç·šé€²è¡Œç²¾ç†Ÿç·´ç¿’ï¼Œæé«˜æ•´é«”çš„ç²¾ç†Ÿç‡ã€‚</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mb-6 text-center">
                                        <p className="text-gray-700 font-semibold mb-2">æ­¡è¿å…‰è‡¨ç†Šæ¨‚æ¨‚å®¶åº­å­¸é™¢</p>
                                        <a href="https://lelelearning.blogspot.com/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:text-blue-800 underline break-all text-sm">
                                            https://lelelearning.blogspot.com/
                                        </a>
                                    </div>

                                    <button onClick={() => setShowHelp(false)} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg">é—œé–‰èªªæ˜</button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (state === 'setup') {
                const types = [
                    { value: 'all', label: 'å…¨éƒ¨é¡Œç›®', icon: 'ğŸ¯' },
                    { value: '2', label: '2çš„å€æ•¸', icon: '2ï¸âƒ£' }, { value: '3', label: '3çš„å€æ•¸', icon: '3ï¸âƒ£' },
                    { value: '4', label: '4çš„å€æ•¸', icon: '4ï¸âƒ£' }, { value: '5', label: '5çš„å€æ•¸', icon: '5ï¸âƒ£' },
                    { value: '6', label: '6çš„å€æ•¸', icon: '6ï¸âƒ£' }, { value: '7', label: '7çš„å€æ•¸', icon: '7ï¸âƒ£' },
                    { value: '8', label: '8çš„å€æ•¸', icon: '8ï¸âƒ£' }, { value: '9', label: '9çš„å€æ•¸', icon: '9ï¸âƒ£' },
                    { value: 'even', label: 'å¶æ•¸', icon: 'ğŸ”¢' }, { value: '235', label: '2,3,5', icon: 'â­' }
                ];
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-400 via-pink-400 to-red-400 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full">
                            <div className="text-center mb-8"><h2 className="text-3xl font-bold text-purple-600 mb-2">æ­¡è¿ï¼Œ{name}ï¼</h2><p className="text-gray-600">æº–å‚™é–‹å§‹ç·´ç¿’</p></div>
                            <div className="mb-6">
                                <label className="block text-lg font-bold text-gray-700 mb-3">ğŸ“ é¸æ“‡ç·´ç¿’é¡Œå‹</label>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    {types.map(t => (
                                        <button key={t.value} onClick={() => setType(t.value)} className={`p-3 rounded-xl font-bold transition-all ${type === t.value ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white scale-105 shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
                                            <div className="flex items-center justify-center gap-1 mb-1">
                                                <span className="text-2xl">{t.icon}</span>
                                                {badges[t.value] && <span className="text-2xl">{badges[t.value].badge}</span>}
                                            </div>
                                            <div className="text-sm">{t.label}</div>
                                            {highScores[t.value] && <div className="text-xs mt-1 opacity-80">æœ€é«˜ï¼š{highScores[t.value].score}é¡Œ</div>}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="mb-6">
                                <label className="block text-lg font-bold text-gray-700 mb-3 flex items-center gap-2"><Icon type="clock" className="w-5 h-5" /> é¸æ“‡æ™‚é–“</label>
                                <div className="grid grid-cols-4 gap-3">{[30, 60, 90, 120].map(t => (<button key={t} onClick={() => setTimeLimit(t)} className={`p-4 rounded-xl font-bold text-lg transition-all ${timeLimit === t ? 'bg-blue-600 text-white scale-105' : 'bg-gray-100 text-gray-700'}`}>{t}ç§’</button>))}</div>
                            </div>
                            <div className="space-y-3">
                                <button onClick={start} className="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg flex items-center justify-center gap-2"><Icon type="play" /> é–‹å§‹éŠæˆ²</button>
                                <button onClick={() => setState('records')} className="w-full bg-gradient-to-r from-orange-500 to-yellow-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg flex items-center justify-center gap-2"><Icon type="chart" /> æŸ¥çœ‹ç´€éŒ„</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (state === 'playing') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-400 via-purple-400 to-pink-400 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full">
                            <div className="flex justify-between items-center mb-8">
                                <div className="bg-blue-100 px-4 py-2 rounded-full"><span className="text-blue-700 font-bold text-lg">{name}: {score}é¡Œ</span></div>
                                <div className={`px-4 py-2 rounded-full font-bold text-lg flex items-center gap-1 ${timeLeft <= 10 ? 'bg-red-100 text-red-700 animate-pulse' : 'bg-green-100 text-green-700'}`}><Icon type="clock" className="w-5 h-5" /> {timeLeft}ç§’</div>
                            </div>
                            <div className="text-center mb-2">
                                <div className="text-sm text-gray-600 mb-4">é¡Œå‹ï¼š{typeNames[type]}</div>
                                <div className="text-6xl font-bold mb-6 flex items-center justify-center gap-4">
                                    <span className="text-purple-600">{question.num1}</span><span className="text-pink-600">Ã—</span>
                                    <span className="text-purple-600">{question.num2}</span><span className="text-pink-600">=</span><span className="text-blue-600">?</span>
                                </div>
                                <input type="number" value={answer} onChange={e => setAnswer(e.target.value)} onKeyPress={e => e.key === 'Enter' && answer && check()} className="text-4xl font-bold text-center w-32 px-4 py-3 border-4 border-purple-300 rounded-xl focus:outline-none focus:border-purple-500" autoFocus />
                                <button onClick={check} disabled={!answer} className="mt-6 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 px-12 rounded-xl hover:scale-105 transition-transform disabled:opacity-50 shadow-lg">æäº¤ç­”æ¡ˆ</button>
                            </div>
                            {feedback && <div className={`text-center text-2xl font-bold py-4 px-6 rounded-xl ${feedback.includes('æ­£ç¢º') ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{feedback}</div>}
                        </div>
                    </div>
                );
            }

            if (state === 'finished') {
                const acc = total > 0 ? Math.round((score / total) * 100) : 0;
                const curr = highScores[type];
                const isNew = !curr || score > curr.score;
                return (
                    <div className="min-h-screen bg-gradient-to-br from-yellow-400 via-orange-400 to-red-400 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
                            <Icon type="trophy" className="w-20 h-20 text-yellow-500 mx-auto mb-4" />
                            <h2 className="text-4xl font-bold text-purple-600 mb-2">éŠæˆ²çµæŸï¼</h2>
                            <p className="text-xl text-gray-600 mb-2">{name} çš„æˆç¸¾</p>
                            <p className="text-sm text-gray-500 mb-6">é¡Œå‹ï¼š{typeNames[type]}</p>
                            {isNew && score > 0 && <div className="bg-yellow-100 border-2 border-yellow-400 rounded-xl p-4 mb-6 animate-pulse"><p className="text-yellow-800 font-bold text-xl">ğŸ‰ æ–°ç´€éŒ„ï¼ğŸ‰</p></div>}
                            <div className="space-y-4 mb-8">
                                <div className="bg-purple-100 p-4 rounded-xl"><p className="text-gray-600 text-lg">æœ¬æ¬¡ç­”å°</p><p className="text-4xl font-bold text-purple-600">{score} é¡Œ</p></div>
                                <div className="bg-blue-100 p-4 rounded-xl"><p className="text-gray-600 text-lg">ç¸½é¡Œæ•¸</p><p className="text-4xl font-bold text-blue-600">{total} é¡Œ</p></div>
                                <div className="bg-green-100 p-4 rounded-xl"><p className="text-gray-600 text-lg">æ­£ç¢ºç‡</p><p className="text-4xl font-bold text-green-600">{acc}%</p></div>
                                <div className="bg-orange-100 p-4 rounded-xl">
                                    <p className="text-gray-600 text-lg">æ­¤é¡Œå‹æœ€é«˜ç´€éŒ„</p>
                                    <p className="text-4xl font-bold text-orange-600">{curr ? curr.score : score} é¡Œ</p>
                                    {curr && <p className="text-xs text-gray-600 mt-2 flex items-center justify-center gap-1"><Icon type="calendar" className="w-4 h-4" />{curr.date}</p>}
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button onClick={start} className="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg">å†ç©ä¸€æ¬¡</button>
                                <button onClick={() => setState('records')} className="w-full bg-gradient-to-r from-orange-500 to-yellow-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg">æŸ¥çœ‹ç´€éŒ„</button>
                                <button onClick={() => setState('setup')} className="w-full bg-gray-200 text-gray-700 text-xl font-bold py-4 rounded-xl hover:bg-gray-300 transition-colors">è¿”å›</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (state === 'records') {
                const weak = Object.entries(scores).sort((a, b) => a[1] - b[1]).slice(0, 10);
                const types = [
                    { value: 'all', label: 'å…¨éƒ¨é¡Œç›®', icon: 'ğŸ¯' },
                    { value: '2', label: '2çš„å€æ•¸', icon: '2ï¸âƒ£' }, { value: '3', label: '3çš„å€æ•¸', icon: '3ï¸âƒ£' },
                    { value: '4', label: '4çš„å€æ•¸', icon: '4ï¸âƒ£' }, { value: '5', label: '5çš„å€æ•¸', icon: '5ï¸âƒ£' },
                    { value: '6', label: '6çš„å€æ•¸', icon: '6ï¸âƒ£' }, { value: '7', label: '7çš„å€æ•¸', icon: '7ï¸âƒ£' },
                    { value: '8', label: '8çš„å€æ•¸', icon: '8ï¸âƒ£' }, { value: '9', label: '9çš„å€æ•¸', icon: '9ï¸âƒ£' },
                    { value: 'even', label: 'å¶æ•¸çš„å€æ•¸', icon: 'ğŸ”¢' }, { value: '235', label: '2,3,5çš„å€æ•¸', icon: 'â­' }
                ];
                return (
                    <div className="min-h-screen bg-gradient-to-br from-cyan-400 via-blue-400 to-purple-400 p-4 overflow-y-auto">
                        <div className="max-w-4xl mx-auto py-8">
                            <div className="bg-white rounded-3xl shadow-2xl p-8 mb-6">
                                <h2 className="text-4xl font-bold text-purple-600 mb-2 text-center">{name} çš„ç·´ç¿’ç´€éŒ„</h2>
                                <p className="text-center text-gray-600 mb-6">å®Œæ•´å­¸ç¿’è¨˜éŒ„</p>
                                
                                {/* çå‹µå¾½ç« å±•ç¤º */}
                                {Object.keys(badges).length > 0 && (
                                    <div className="mb-8">
                                        <h3 className="text-2xl font-bold text-green-600 mb-4 flex items-center gap-2">
                                            ğŸ–ï¸ ç²å¾—çš„çå‹µå¾½ç« 
                                        </h3>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                            {Object.entries(badges).map(([typeVal, badge]) => (
                                                <div key={typeVal} className="bg-gradient-to-br from-green-50 to-emerald-100 border-2 border-green-300 rounded-xl p-4 text-center shadow-lg">
                                                    <div className="text-5xl mb-2">{badge.badge}</div>
                                                    <div className="font-bold text-gray-800 text-sm">{typeNames[typeVal]}</div>
                                                    <div className="text-xs text-green-700 font-semibold mt-1">{badge.name}</div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="mt-4 text-center text-sm text-gray-600">
                                            <div className="flex justify-center gap-4 flex-wrap">
                                                <span>â­ å„ªç§€çï¼šå…¨éƒ¨80åˆ†ä»¥ä¸Š</span>
                                                <span>ğŸ… ç²¾é€šçï¼šå…¨éƒ¨90åˆ†ä»¥ä¸Š</span>
                                                <span>ğŸ’¯ æ»¿åˆ†çï¼šå…¨éƒ¨100åˆ†</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="mb-8">
                                    <h3 className="text-2xl font-bold text-amber-600 mb-4 flex items-center gap-2"><Icon type="trophy" /> å„é¡Œå‹æœ€é«˜åˆ†ç´€éŒ„</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {types.map(t => {
                                            const r = highScores[t.value];
                                            return (
                                                <div key={t.value} className={`p-4 rounded-xl border-2 ${r ? 'bg-amber-50 border-amber-300' : 'bg-gray-50 border-gray-200'}`}>
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex items-center gap-2"><span className="text-2xl">{t.icon}</span><span className="font-bold text-gray-800">{t.label}</span></div>
                                                        <div className="text-right">
                                                            {r ? (<><div className="text-2xl font-bold text-amber-600">{r.score} é¡Œ</div><div className="text-xs text-gray-600 flex items-center gap-1 justify-end mt-1"><Icon type="calendar" className="w-3 h-3" />{r.date}</div></>) : (<div className="text-sm text-gray-400">å°šç„¡ç´€éŒ„</div>)}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                                <div className="mb-8">
                                    <h3 className="text-2xl font-bold text-red-600 mb-4 flex items-center gap-2"><Icon type="down" /> éœ€è¦åŠ å¼· (æœ€ä½10é¡Œ)</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                        {weak.map(([q, s]) => {
                                            const [n1, n2] = q.split('x');
                                            return (<div key={q} className="bg-red-50 border-2 border-red-300 rounded-xl p-3 text-center"><div className="text-xl font-bold">{n1} Ã— {n2}</div><div className="text-sm text-red-600 font-semibold">{s} åˆ†</div></div>);
                                        })}
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-2xl font-bold text-blue-600 mb-4 flex items-center gap-2"><Icon type="chart" /> å®Œæ•´ä¹ä¹ä¹˜æ³•è¡¨</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full border-collapse">
                                            <thead><tr className="bg-gray-100"><th className="border-2 border-gray-300 p-2">Ã—</th>{[1,2,3,4,5,6,7,8,9].map(n => <th key={n} className="border-2 border-gray-300 p-2">{n}</th>)}</tr></thead>
                                            <tbody>
                                                {[1,2,3,4,5,6,7,8,9].map(i => (
                                                    <tr key={i}><td className="border-2 border-gray-300 p-2 bg-gray-100 font-bold">{i}</td>
                                                    {[1,2,3,4,5,6,7,8,9].map(j => {
                                                        const s = scores[`${i}x${j}`] || 50;
                                                        const bg = s >= 80 ? 'bg-green-100' : s >= 60 ? 'bg-yellow-100' : s >= 40 ? 'bg-orange-100' : 'bg-red-100';
                                                        return <td key={j} className={`border-2 border-gray-300 p-2 text-center ${bg}`}><div className="text-sm font-semibold">{s}</div></td>;
                                                    })}</tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="flex justify-center gap-4 mt-4 text-sm flex-wrap">
                                        <div className="flex items-center gap-2"><div className="w-6 h-6 bg-green-100 border"></div><span>80+</span></div>
                                        <div className="flex items-center gap-2"><div className="w-6 h-6 bg-yellow-100 border"></div><span>60-79</span></div>
                                        <div className="flex items-center gap-2"><div className="w-6 h-6 bg-orange-100 border"></div><span>40-59</span></div>
                                        <div className="flex items-center gap-2"><div className="w-6 h-6 bg-red-100 border"></div><span>0-39</span></div>
                                    </div>
                                </div>
                            </div>
                            <button onClick={() => setState('setup')} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 rounded-xl hover:scale-105 transition-transform shadow-lg">è¿”å›ä¸»é¸å–®</button>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>